<!-- templates/results.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Visual Comparison Results</title>
    <!-- Keep all your existing CSS styles -->
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; margin: 0; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .controls { text-align: center; padding: 15px; background-color: #fff; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .controls button { padding: 8px 15px; cursor: pointer; margin: 0 5px; }
        .info-bar { display: flex; justify-content: center; gap: 40px; margin-bottom: 20px; font-size: 1.1em; }
        .info-bar span { font-weight: bold; }
        #comparison-container { position: relative; margin: 0 auto; width: 100%; }
        #comparison-container.side-by-side { display: flex; gap: 10px; }
        #comparison-container img { max-width: 100%; height: auto; border: 2px solid #ccc; background-color: white; box-sizing: border-box; }
        #comparison-container.side-by-side img { flex: 1; min-width: 0; }
        #comparison-container:not(.side-by-side) img { position: absolute; top: 0; left: 0; }
        #img-diff { display: none; z-index: 10 !important; pointer-events: none; }
        .side-by-side .overlay-slider { display: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Comparison Results</h1>
        <div class="info-bar">
            <div>Viewport: <span>{{ viewport }}</span></div>
            <div>Mismatched Pixels: <span>{{ diff_pixels }}</span></div>
        </div>
        <a href="{{ url_for('index') }}">Run another comparison</a>
    </div>

    <div class="controls">
        <button id="toggle-view-btn">Switch to Side-by-Side (V)</button>
        <button id="swap-btn">Swap Top/Bottom (S)</button>
        <button id="toggle-diff-btn">Show Pixel Diff (D)</button>
        <span class="overlay-slider">
            <label for="opacity-slider">Opacity:</label>
            <input type="range" id="opacity-slider" min="0" max="1" step="0.01" value="0.5">
        </span>
    </div>

    <div id="comparison-container">
        <!-- CHANGE: Use dynamic URLs passed from Flask -->
        <img id="img-old" src="{{ url_for('static', filename=old_image_url) }}" alt="Old Website">
        <img id="img-new" src="{{ url_for('static', filename=new_image_url) }}" alt="New Website">
        <img id="img-diff" src="{{ url_for('static', filename=diff_image_url) }}" alt="Difference">
    </div>

    <!-- Keep all your existing JavaScript logic. It does not need to be changed. -->
    <script>
        const container = document.getElementById('comparison-container');
        const imgOld = document.getElementById('img-old');
        const imgNew = document.getElementById('img-new');
        const imgDiff = document.getElementById('img-diff');
        const opacitySlider = document.getElementById('opacity-slider');
        const swapBtn = document.getElementById('swap-btn');
        const toggleViewBtn = document.getElementById('toggle-view-btn');
        const toggleDiffBtn = document.getElementById('toggle-diff-btn');
        let topOrLeftImageIsNew = 1;
        function updateStyles() { if (container.classList.contains('side-by-side')) { imgOld.style.order = topOrLeftImageIsNew ? 2 : 1; imgNew.style.order = topOrLeftImageIsNew ? 1 : 2; imgNew.style.opacity = 1; imgOld.style.opacity = 1; imgNew.style.zIndex = 'auto'; imgOld.style.zIndex = 'auto'; } else { if (topOrLeftImageIsNew) { imgNew.style.zIndex = 2; imgOld.style.zIndex = 1; imgNew.style.opacity = opacitySlider.value; imgOld.style.opacity = 1; } else { imgNew.style.zIndex = 1; imgOld.style.zIndex = 2; imgOld.style.opacity = opacitySlider.value; imgNew.style.opacity = 1; } imgOld.style.order = 'unset'; imgNew.style.order = 'unset'; } }
        opacitySlider.addEventListener('input', updateStyles);
        swapBtn.addEventListener('click', () => { topOrLeftImageIsNew = 1 - topOrLeftImageIsNew; updateStyles(); });
        toggleViewBtn.addEventListener('click', () => { const isSideBySide = container.classList.toggle('side-by-side'); toggleViewBtn.textContent = isSideBySide ? 'Switch to Overlay (V)' : 'Switch to Side-by-Side (V)'; swapBtn.textContent = isSideBySide ? 'Swap Left/Right (S)' : 'Swap Top/Bottom (S)'; updateStyles(); });
        toggleDiffBtn.addEventListener('click', () => { const isHidden = imgDiff.style.display === 'none' || imgDiff.style.display === ''; imgDiff.style.display = isHidden ? 'block' : 'none'; toggleDiffBtn.textContent = isHidden ? 'Hide Pixel Diff (D)' : 'Show Pixel Diff (D)'; });
        document.addEventListener('keydown', (event) => { if (event.target.tagName.toLowerCase().match(/input|textarea/)) return; switch (event.key.toLowerCase()) { case 's': swapBtn.click(); break; case 'v': toggleViewBtn.click(); break; case 'd': toggleDiffBtn.click(); break; } });
        updateStyles();
    </script>
</body>
</html>